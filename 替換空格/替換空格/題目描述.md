# 替換空格

ref:
<https://www.nowcoder.com/practice/0e26e5551f2b489b9f58bc83aa4b6c68?tpId=13&tqId=11155&tab=answerKey&from=cyc_github>
<https://github.com/CyC2018/CS-Notes/blob/master/notes/5.%20%E6%9B%BF%E6%8D%A2%E7%A9%BA%E6%A0%BC.md>

## 描述

請實現一個函式，將一個字串 s 中的每個空格替換成「%20」。

例如，當字串為「We Are Happy」時，經過替換之後的字串為「We%20Are%20Happy」。

**資料範圍**： 0 ≤ len (s) ≤ 1000。保證字串中的字元為大寫英文字母、小寫英文字母和空格中的一種。

## 範例 1

**輸入**：

"We Are Happy"

**返回值**：

"We%20Are%20Happy"

## 範例 2

**輸入**：

" "

**返回值**：

"%20"

---

## 兩種解法比較與分析

### 1. ReplaceSpace (for 迴圈組裝)

**優點**：

- 可讀性高，邏輯直觀，容易理解與維護。
- 實作簡單，適合大多數一般應用場景。
- 不會改變原始字串，安全性高。

**缺點**：

- 每遇到一個空格就 append 三個字元，對於空格非常多的長字串，StringBuilder 可能多次擴充記憶體。
- 每個字元都要判斷一次，雖然時間複雜度 O (n)，但實際效能略低於雙指標法 (特別是空格多時)。

**效率**：

- 時間複雜度 O (n)
- 空間複雜度 O (n)
- 適合短字串或空格較少的情境

### 2. ReplaceSpace2 (雙指標逆向填充)

**優點**：

- 適合處理大字串與空格數量多的情境，減少搬移次數，效能更佳。
- 只需一次擴充記憶體，搬移過程不會產生多餘的中間結果。
- 時間複雜度同樣為 O (n)，但常數項較小，實際效能更快。

**缺點**：

- 可讀性較低，邏輯較複雜，不熟悉雙指標技巧者較難維護。
- 需要額外理解指標操作與逆向搬移的細節。
- 需將字串轉為 StringBuilder，且原地修改，若有多執行緒需求需注意。

**效率**：

- 時間複雜度 O (n)
- 空間複雜度 O (n)
- 適合長字串、空格多、效能敏感的場景

### 可讀性比較

- ReplaceSpace 可讀性高，維護容易，適合教學與一般業務邏輯。
- ReplaceSpace2 可讀性較低，但效能最佳，適合面試、效能瓶頸或大資料量處理。

**總結建議**：
一般情境建議用 ReplaceSpace，若遇到效能瓶頸或字串極長、空格極多時，再考慮 ReplaceSpace2。

---

## 為什麼 ReplaceSpace2 要用逆向填充？順向不行嗎？

逆向填充 (從尾端往前填) 是為了解決「原地修改」時避免覆蓋未處理資料的問題。

如果採用順向 (從頭到尾) 填充，當你遇到空格要插入「%20」時，必須將後面的所有字元往後搬移兩格，這樣每遇到一個空格都要搬移多次，效率會很差 (最壞情況下時間複雜度會變成 O (n²))。

而逆向填充的做法是：

1. 先計算所有空格數，將字串長度一次擴展到足夠。
2. 設定兩個指標：P1 指向原字串尾端，P2 指向擴展後的尾端。
3. 從尾端往前搬移，遇到空格就逆向填入「%20」，不是空格就直接搬移。
4. 這樣每個字元只搬移一次，不會覆蓋還沒處理的資料，效率高 (O (n))。

**總結**：

- 順向填充會導致多次搬移，效率低。
- 逆向填充只需一次搬移，且不會覆蓋未處理的字元，效率高且安全。

這就是為什麼要用「逆向填充」而不是「順向填充」的原因。

---

## ReplaceSpace2 步驟推理與範例

假設輸入字串為：

```csharp
string input = "A B C";
string result = new Program().ReplaceSpace2(input);
// 輸出結果：A%20B%20C
```

### 步驟推理與演示

1. 初始狀態
   - 輸入字串為 "A B C"
   - 字元數：5 (A、空格、B、空格、C)
2. 計算空格數並擴展長度
   - 空格數：2
   - 每個空格需多 2 個字元空間 (因「%20」有 3 個字元)
   - 擴展後長度：5 + 2\*2 = 9
   - StringBuilder 內容暫為 "A B C"(後面多了 4 個空白)
3. 設定雙指標
   - P1 指向原字串尾端 (index 4，C)
   - P2 指向擴展後字串尾端 (index 8)
4. for 迴圈逆向搬移與替換
   - P1=4, P2=8：C → sb\[8] = 'C'
   - P1=3, P2=7：空格 → sb \[7]='0', sb \[6]='2', sb \[5]='%'
   - P1=2, P2=4：B → sb\[4]='B'
   - P1=1, P2=3：空格 → sb \[3]='0', sb \[2]='2', sb \[1]='%'
   - P1=0, P2=0：A → sb\[0]='A'
5. 最終結果
   - StringBuilder 內容為 "A%20B%20C"
   - 回傳結果

### 步驟總結

- 先計算空格數，擴展 StringBuilder 長度
- 兩個指標從尾端往前搬移
- 遇到空格就逆向填入「%20」
- 其他字元直接搬移
- 最後得到所有空格都被替換為「%20」的新字串

這種寫法能有效減少多餘搬移，特別適合大字串處理，且每個字元只處理一次，效率高。
